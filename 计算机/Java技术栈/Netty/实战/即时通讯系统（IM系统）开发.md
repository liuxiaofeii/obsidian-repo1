---

excalidraw-plugin: parsed
tags: [excalidraw]

---
==⚠  Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. ⚠== You can decompress Drawing data with the command palette: 'Decompress current Excalidraw file'. For more info check in plugin settings under 'Saving'


# Excalidraw Data
## Text Elements
前期：调研、选型、测试、联调 ^TjpDSGa1

整体架构图 ^eMbUhbHZ

一个基本的IM系统的构成 ^x5jQeqt7

用户是消息的发起者 ^20AdGqfw

关系链是指用户与用户之间的关联。
例如，OA系统里用户与用户之间可能是上下级；
电商系统里面用户与用户之间可能是买家和卖家；
在IM系统里面用户与用户之间是好友或者非好友关系、拉黑或者非拉黑关系。 ^DfVm64SH

会话是用户与用户之间产生消息的产物，
在QQ和微信里面也是通过消息而产生会话 ^XP1SbPe2

客户 ^LE1PmDde

客服 ^ypldcG9e

客服端发起长轮询向服务器尝试获取新消息，
如果没有消息则会定时反复执行这个操作 ^jeAt3G0n

缺点：存在很多的空循环：如果客服与用户之间没有产生消息，整个系统也是在不断的轮询获取空数据 ^A0eab56U

接入层负责收集客户端发来的消息 ^HBxxD3n0

## Embedded Files
2d419ee97e0d446b45b091956294fa0621dac84f: [[Pasted Image 20240529101108_153.png]]
43775388aaef3b91889b7560ab30ecc0fa90fd21: [[Pasted Image 20240529101748_061.png]]
20377c1912254768a3f56b0241ac9fb3c5d02463: [[Pasted Image 20240529102444_002.png]]
35643e0c3c29122e3235be3be94b9820b643136b: [[Pasted Image 20240529103206_071.png]]
cf4054495a7861d6eb811d5dac821eda4c29368f: [[Pasted Image 20240529104228_197.png]]

%%
## Drawing
```compressed-json
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
```
%%